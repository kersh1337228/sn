{% load static %}
{% load user_tags %}

<div class="user_note">
    <div class="note_info">
        <div class="note_poster_full_name">
            {% if note.user %}
                <a href="{% url 'user_page' user_id=note.user.user_id %}">
                    {{ note.user.first_name }} {{ note.user.last_name }}
                </a>
            {% else %}
                <a href="{% url 'community_page' community_id=note.community.community_id %}">
                    {{ note.community.name }}
                </a>
            {% endif %}
        </div>
        <div>
            <div class="note_edit">
                ...
                <ul class="note_edit_menu">
                    <li class="note_edit_menu_edit">
                        <a href="{% url 'user_page_edit_note' user_id=user.user_id note_id=note.note_id %}">
                            Edit
                        </a>
                    </li>
                    <li class="note_edit_menu_delete">
                        <a href="{% url 'user_page_delete_note' user_id=user.user_id note_id=note.note_id %}">
                            Delete
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <br><div>{{ note.text }}</div><br>
    <div class="note_time">{{ note.publish_time|date:'d-m-Y H:i:s' }}</div>
    {% if note.update_time != note.publish_time %}
        <div class="note_time">Last edited: {{ note.update_time|date:'d-m-Y H:i:s' }}</div>
    {% endif %}
    <br><div class="note_statistics">
        <div>
            {% if not user in note.liked_by.all %}
                <a href="{% url 'like_note' user_id=user.user_id note_id=note.note_id action='like' %}">
                    <img src="{% static 'icons/inactive_like_icon.png' %}" alt="" width="15px" height="15px">
                </a>
                {{ note.likes.all|length }}
            {% else %}
                <a href="{% url 'like_note' user_id=user.user_id note_id=note.note_id action='dislike' %}">
                    <img src="{% static 'icons/active_like_icon.png' %}" alt="" width="15px" height="15px">
                </a>
                {{ note.likes.all|length }}
            {% endif %}
        </div>
        <div>
            <img src="{% static 'icons/comment_icon.png' %}" alt="" width="15px" height="15px" class="comment_icon">
            {{ note.comments.all|length }}
        </div>
        <div>
            Reposts: {{ note.reposts_amount }}
        </div>
    </div>
    <br><div class="note_comments">
        {% if note.comments.all %}
            {% for comment in note.comments.all %}
                {% comment_tag user=user comment=comment note=note reply_add_form=comment_add_form %}
            {% endfor %}
        {% else %}
            No comments yet
        {% endif %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <br>
            <div class="form_error">{{ comment_add_form.non_field_errors }}</div>
            <div class="chat_content_grid_cell_write_message_inner_grid">
                {% attach_content_tag %}
                {% for field in comment_add_form %}
                    <div class="form_error">{{ field.errors }}</div>
                    {{ field }}
                {% endfor %}
                <input type="text" name="{{ note.note_id }}" id="note_id">
                <button type="submit" class="send_message_button" name="comment_btn"></button>
                <div class="send_message_icon">Leave</div>
            </div>
        </form>
    </div>
</div>