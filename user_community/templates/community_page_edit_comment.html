{% extends 'base.html' %}
{% load static %}
{% load user_tags %}
{% load community_tags %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
    {% with request.user as user %}
    <div class="user_page_content_grid">
        {% community_actions_tag community=community community_state=community_state %}
        <div class="grid_cell_personal_data">
            {{ community.name }}
        </div>
        <div class="grid_cell_note_list">
            {% if notes %}
                {% for note in notes %}
                    {% if note.note_id == current_note_id %}
                        <div class="user_note">
                            <div class="note_info">
                                <div class="note_poster_full_name">
                                    {% if note.user %}
                                        {{ note.user.first_name }} {{ note.user.last_name }}
                                    {% else %}
                                        {{ note.community.name }}
                                    {% endif %}
                                </div>
                            </div>
                            <br><div>{{ note.text }}</div><br>
                            <div class="note_time">{{ note.publish_time|date:'d-m-Y H:i:s' }}</div>
                            {% if note.update_time != note.publish_time %}
                                <div class="note_time">Edited: {{ note.update_time|date:'d-m-Y H:i:s' }}</div>
                            {% endif %}
                            <br><div class="note_statistics">
                                <div>
                                    {% if not user in note.liked_by.all %}
                                        <img src="{% static 'icons/inactive_like_icon.png' %}" alt="" width="15px" height="15px">
                                        {{ note.likes.all|length }}
                                    {% else %}
                                        <img src="{% static 'icons/active_like_icon.png' %}" alt="" width="15px" height="15px">
                                        {{ note.likes.all|length }}
                                    {% endif %}
                                </div>
                                <div>
                                    <img src="{% static 'icons/comment_icon.png' %}" alt="" width="15px" height="15px">
                                    {{ note.comments.all|length }}
                                </div>
                                <div>
                                    Reposts: {{ note.reposts_amount }}
                                </div>
                            </div>
                            <br><div class="note_comments_displayed">
                                {% if note.comments.all %}
                                    {% for comment in note.comments.all %}
                                        {% if comment.comment_id != current_comment_id %}
                                            {% post_tag type='comment' post=comment user=request.user community=community comment=comment note=note reply_add_form=comment_add_form %}
                                        {% else %}
                                            <div class="user_comment">
                                                {% form_tag form=form type='comment' note=note comment=comment %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    No comments yet
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                No posts here
            {% endif %}
        </div>
    </div>
    {% endwith %}
{% endblock %}